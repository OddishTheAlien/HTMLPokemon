<html>
    <head>
        <title>RPG HTML-JS</title>
        <link rel="icon" href="favicon.ico">
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="text/javascript"></script>
        <script src="rectangle.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="data.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="dialog.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="touch.js" type="text/javascript"></script>
        <script src="character.js" type="text/javascript"></script>
        <script src="event.js" type="text/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 480;//480;
            var canvasHeight = 352;//352;
            
            // TODO: fix bug: if canvas is bigger than tilemap map moves to the responding end
            // Or make Tilemap always bigger than canvas
            
            var sheeps = new Sprite("Panorama/AngrySheeps.jpg", 320, 240, 1, 1);
            var sunset = new Sprite("Panorama/sunset1.png", 320, 240, 1, 1);
               
            var audio1 = new Audio('Music/banana-phone.ogg');
            var audio2 = new Audio('Music/forest.ogg');
            var audio3 = new Audio('Music/snow.ogg');
            var catsound = new Audio('Sound/cat.m4a');
            audio1.volume = 0.2;
            audio2.volume = 0.2;
            audio3.volume = 0.2;
            catsound.volume = 0.2;
            
            var staticGrid = false;
            
            var mouse_x = 0;
            var mouse_y = 0;
            
            var charX = [300, 100];
            var charY = [100, 100];
            
            var prevX = 0;
            var prevY = 0;
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                // Easy access to grafics (gfx)
                window.gfx = Context.context;
                
                InitializeKeyboard();
                
                InitalizeAnimationCounters();
                
                InitalizeMouse();
                
                InitalizeTouch();
                
                LoadGamestate();
                
            });
            
            $(window).on('load', function () {});
            
            setInterval(function() {
                
                /*
                // Resize Screen on leaving Fullscreen Mode
                canvasWidth = 480;
                canvasHeight = 352;
                Context = new HTML("game", canvasWidth, canvasHeight);
                */
                
                ResetAnimationCounter();
                
                // Layer 0: Panorama
                // Background: TODO: Implement moving background
                // Stretch panorama to canavas size for a background
                if (mapID == 0) {
                    sunset.draw2(0, 0, canvasWidth, canvasHeight);
                }
                if (mapID == 1) {
                    sheeps.draw2(0, 0, canvasWidth, canvasHeight);
                }
                
                // Layer 1.1: Walkable ground 
                DrawBackgroundMap();
                
                // Layer 1.2: Objects on the ground below Layer 3
                //TODO: add in world.js
                
                // Layer 3: character & objects
                //DrawObjects();                

                // Draws motion of moveable objects
                DrawEvents();
                DrawObjects();
                DrawCharacter();
                
                DrawForegroundMap();
                
                if (staticGrid)
                    DrawGrid();
                
                // Layer 4: Objects over Layer 3 - i.e. stand behind a tree
                // TODO: add in world.js
                

                
            }, framerate);
        
        </script>
        
    </head>


    <body background="Panorama/Background.jpg">
        <h1 id="title" >Testing</h1>
        <p><button onclick="enterFullscreen(document.getElementById('game'))" id="exit">Fullscreen</button></p>
        
        <h5>
            <div>Press "9" to disable scrollbar. Press "0" to enable it.</div>
            <div>Control: WASD or Arrow-Key</div>
            <div>Press "1" for Grassmap. Press "2" for Snowmap.</div>
            <div>Press "4" to save gamestate using cookies; Press "5" to load gamestate</div>
        </h5>
        
        <canvas id="game"></canvas>
        
        <h5>            
            TODO:            
            <div>- Refine Collision Detection</div>
            <div>- Add NPCs/Objects properly</div>
            <div>- Refine Dialogs</div>
            <div>- Implement Enter/Touch-Interaction with NPCs/Objects</div>
            <div>- Implement Event System</div>
            <div>- Implement Movement via Touch</div>
            <div>- New Save/Load Gamestate or refine solution using cookies</div>
            <div>- Implement proper Audio Select/Play System</div>
            <div>- Implement System Menu on Esc + Character Stats</div>
            <div>- Implement Battle System</div>
        </h5>    
        
    </body>    
</html>