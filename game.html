<html>
    <head>
        <title>RPG HTML-JS</title>
        <link rel="icon" href="favicon.ico">
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="utility.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="text/javascript"></script>
        <script src="rectangle.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="data.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="dialog.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="touch.js" type="text/javascript"></script>
        <script src="character.js" type="text/javascript"></script>
        <script src="event.js" type="text/javascript"></script>

        <script language = "javascript">

            var Context = null;
            var framerate = 24;

            var canvasWidth = 480;//480;
            var canvasHeight = 352;//352;

            // TODO: fix bug: if canvas is bigger than tilemap map moves to the responding end
            // Or make Tilemap always bigger than canvas

            var sheeps = new Sprite("Panorama/AngrySheeps.jpg", 320, 240, 1, 1);
            var sunset = new Sprite("Panorama/sunset1.png", 320, 240, 1, 1);

            var audio1 = new Audio('Music/banana-phone.ogg');
            var audio2 = new Audio('Music/forest.ogg');
            var audio3 = new Audio('Music/snow.ogg');
            var catsound = new Audio('Sound/cat.m4a');
            audio1.volume = 0.2;
            audio2.volume = 0.2;
            audio3.volume = 0.2;
            catsound.volume = 0.2;

            var mouse_x = 0;
            var mouse_y = 0;

            var charX = [300, 100];
            var charY = [100, 100];

            var prevX = 0;
            var prevY = 0;

            $(document).ready(function() {

                Context = new HTML("game", canvasWidth, canvasHeight);

                // Easy access to grafics (gfx)
                window.gfx = Context.context;

                InitializeKeyboard();

                InitalizeAnimationCounters();

                InitalizeMouse();

                //InitalizeTouch();
                
                // Deactivate Tab
                $(document).keydown(function(objEvent) {
                    if (objEvent.keyCode == 9) {  //tab pressed
                        objEvent.preventDefault(); // stops its action
                    }
                });
            });            
            

            $(window).on('load', function () {});
            
            $(window).on('unload', function() {});
            
            setInterval(function() {

                ResetAnimationCounter();

                // Layer 0: Panorama
                // Background: TODO: Implement moving background
                // Stretch panorama to canavas size for a background
                if (mapID == 0) {
                    sunset.draw2(0, 0, canvasWidth, canvasHeight);
                }
                if (mapID == 1) {
                    sheeps.draw2(0, 0, canvasWidth, canvasHeight);
                }

                // Layer 1: Map below the character & objects
                DrawBackgroundMap();

                // Layer 2: character & objects                
                DrawObjects();
                DrawCharacter();

                // Layer 3: Map above the character & objects
                DrawForegroundMap();
                
                // Standard Events on key-input
                gameEvents();

            }, framerate);

        </script>

    </head>


    <body background="Panorama/Background.jpg">
        <h1 id="title" >Testing</h1>
        <h5>
            <div>Control: WASD or Arrow-Key</div>
            <div>Press "1" for Grassmap. Press "2" for Snowmap.</div>
        </h5>

        <div>
            <button onclick="enterFullscreen(document.getElementById('game'))" unselectable="on">Fullscreen</button>
            <button onclick="resizeCanvas()" unselectable="on">Resize</button>
            <button onclick="EnableScrollbar()" unselectable="on">Scrollbar On</button>
            <button onclick="DisableScrollbar()" unselectable="on">Scrollbar Off</button>
        </div>

        <canvas id="game"></canvas>

        <div style="text-align: center; width: 480px;">
            <button onmousedown="key.up = true" ontouchstart="key.up = true" onmouseup="key.up = false" ontouchend="key.up = false" ontouchcancel="key.up = false" unselectable="on">UP</button><br><br>
            <button onmousedown="key.left = true" ontouchstart="key.left = true" onmouseup="key.left = false"  ontouchend="key.left = false" ontouchcancel="key.left = false" unselectable="on">LEFT</button>
            <button onmousedown="key.right = true" ontouchstart="key.right = true" onmouseup="key.right = false" ontouchend="key.right = false" ontouchcancel="key.right = false" unselectable="on">RIGHT</button><br><br>
            <button onmousedown="key.down = true" ontouchstart="key.down = true" onmouseup="key.down = false" ontouchend="key.down = false" ontouchcancel="key.down = false" unselectable="on">DOWN</button>
        </div>

        <button onmousedown="key.enter = true" ontouchstart="key.enter = true" onmouseup="key.enter = false" ontouchend="key.enter = false" ontouchcancel="key.enter = false" unselectable="on">Enter</button>


        <h5>            
            TODO:            
            <div>- Collision Detection and Resolving with Objects</div>
            <div>- Add NPCs/Objects properly</div>
            <div>- Refine Dialogs</div>
            <div>- Implement Enter/Touch-Interaction with NPCs/Objects</div>
            <div>- Implement Event System</div>
            <div>- Implement Movement via Touch</div>
            <div>- New Save/Load Gamestate or refine solution using cookies</div>
            <div>- Implement proper Audio Select/Play System</div>
            <div>- Implement System Menu on Esc + Character Stats</div>
            <div>- Implement Battle System</div>
        </h5>    

    </body>    
</html>