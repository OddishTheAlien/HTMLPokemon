<html>
    <head>
        <title>RPG GAME</title>
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            var BLOCK_W = 32;
            var BLOCK_H = 32;
            
            var char_x = 64;
            var char_y = 32;
            var speed = 5;
            
            var dog_x = 32;
            var dog_y = 32;
            
            var rotwise = 1;
            
            var tilemapWidth = 10;
            var tileMapHeight = 10;
            
            var wall = new Sprite("wall.png");
            var water = new Sprite("water.png");
            
            var character = new Sprite("char.png");
            
            var dog = new Sprite("dog-sprite-sheet.png");
            var dog_is_moving = false;
            var dog_direction = 0;
            
            var audio = new Audio('banana-phone.m4a');
            //audio.play();
            
            
            
            var map = [0,0,0,0,0,0,0,0,0,0,
                       0,0,1,1,1,1,0,0,0,0,
                       0,0,1,1,1,1,0,0,0,0,
                       0,0,1,1,0,0,0,0,0,0,
                       0,0,1,1,1,0,0,0,0,0,
                       0,0,0,1,1,1,0,0,0,0,
                       0,0,0,0,1,1,1,0,0,0,
                       0,0,0,0,0,1,1,0,0,0,
                       0,0,0,0,0,0,0,0,0,0,
                       0,0,0,0,0,0,0,0,0,0 ];
            
            var mapIndex = 0;
            
            $(document).ready(function() {
                
                Context = new HTML("game", 640, 480);
                
                InitializeKeyboard();
                
                //InitializeMouse();
                
                DisableScrollbar();
                
                InitalizeAnimationCounters();
            });
            
            $(window).on('load', function () {
                
            });
            
            setInterval(function() {
                
                ResetAnimationCounter();
                
                DrawMap();
                
                dog_is_moving = false;
                
                dog_direction = 0;
                
                if (key.enter) {
                    if (rotwise == 1)
                        rotwise = -1;
                    else rotwise = 1;
                }                    
                if (key.up || key.w) {
                    dog_y -= speed;
                    if (dog_y < -12) {
                        dog_y = -12;
                    }
                    dog_direction |= DIR_N;
                    dog_is_moving = true;
                }
                if (key.down || key.s) {
                    dog_y += speed;
                    if (dog_y > 416) {
                        dog_y = 416;
                    }
                    dog_direction |= DIR_S;
                    dog_is_moving = true;
                }
                if (key.left || key.a) {
                    dog_x -= speed;
                    if (dog_x < -16) {
                        dog_x = -16;
                    }
                    dog_direction |= DIR_W;
                    dog_is_moving = true;
                }
                if (key.right || key.d) {
                    dog_x += speed;
                    if (dog_x > 576) {
                        dog_x = 576;
                    }
                    dog_direction |= DIR_E;
                    dog_is_moving = true;
                }
                if (key.plus) {
                    speed++;
                    if (speed > 10) {
                        speed = 10;
                    }
                }
                if (key.minus) {
                    speed--;
                    if (speed < 1) {
                        speed = 1;
                    }
                }
                if (key.esc) {
                    audio.play();
                }
                
                // Animated characters
            var dog_seq = 0;

            if (dog_is_moving)
            {
                if (dog_direction & DIR_W) dog_seq = [33,34,35,36];
                if (dog_direction & DIR_E) dog_seq = [1,2,3,4];
                if (dog_direction & DIR_N) dog_seq = [49,50,51,52];
                if (dog_direction & DIR_S) dog_seq = [17,18,19,20];
                if (dog_direction & DIR_N && dog_direction & DIR_E) dog_seq = [57,58,59,60];
                if (dog_direction & DIR_N && dog_direction & DIR_W) dog_seq = [41,42,43,44];
                if (dog_direction & DIR_S && dog_direction & DIR_E) dog_seq = [9,10,11,12];
                if (dog_direction & DIR_S && dog_direction & DIR_W) dog_seq = [25,26,27,28];

                // Finally, animate the dog.
                dog.draw(dog_x, dog_y, dog_seq);
            }
            else
            {
                dog.draw(dog_x, dog_y, 0);
            }
                // Animated characters
                //character.draw(char_x,char_y, [1,2,3,4]);
                //character.drawAnimated(mouseX,mouseY, [0,13,26,39]);
                //char2.drawAnimated(126, 126, [26,27,28,29,30,31,32]);                
                
            }, framerate);
        
        </script>
    </head>


    <body>
        
        <canvas id="game"></canvas>
        
    </body>    
</html>