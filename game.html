<html>
    <head>
        <title>RPG GAME</title>
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 320;
            var canvasHeight = 288;
            
            var char_x = 16;
            var char_y = 16;
            var speed = 2;
                     
            var sprite_width = 24;
            var sprite_height = 32;
            
            var stone = new Sprite("stone.png");
            var grass = new Sprite("grass.png");
            
            //var character = new Sprite("dog-sprite-sheet.png");
            var character = new Sprite("character.png");
            var character_is_moving = false;
            var character_direction = 0;
            var character_look = 0;
            
            //var audio = new Audio('banana-phone.m4a');
            var audio = new Audio('Forest.m4a');
            
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                InitializeKeyboard();
                
                //InitializeMouse();
                
                DisableScrollbar();
                
                InitalizeAnimationCounters();
            });
            
            $(window).on('load', function () {
                
            });
            
            setInterval(function() {
                
                ResetAnimationCounter();
                
                DrawMap();
                
                character_is_moving = false;
                
                character_direction = 0;
                
                if (key.enter) {
                    
                }
                // <if else> for four direction movement
                if (key.up || key.w) {
                    char_y -= speed;
                    if (char_y < -16) {
                        char_y = -16;
                    }
                    character_direction |= DIR_N;
                    character_look = DIR_N;
                    character_is_moving = true;
                }
                else if (key.down || key.s) {
                    char_y += speed;
                    if (char_y > 288-32) {
                        char_y = 288-32;
                    }
                    character_direction |= DIR_S;
                    character_look = DIR_S;
                    character_is_moving = true;
                }
                else if (key.left || key.a) {
                    char_x -= speed;
                    if (char_x < -4) {
                        char_x = -4;
                    }
                    character_direction |= DIR_W;
                    character_look = DIR_W;
                    character_is_moving = true;
                }
                else if (key.right || key.d) {
                    char_x += speed;
                    if (char_x > 320-20) {
                        char_x = 320-20;
                    }
                    character_direction |= DIR_E;
                    character_look = DIR_E;
                    character_is_moving = true;
                }
                if (key.plus) {
                    speed++;
                    if (speed > 10) {
                        speed = 10;
                    }
                }
                if (key.minus) {
                    speed--;
                    if (speed < 1) {
                        speed = 1;
                    }
                }
                if (key.o) {
                    audio.play();
                }
                if (key.p) {
                    audio.pause();
                }
                /*
                // Animated character
                var char_seq = 0;
                
                if (character_is_moving)
                {
                    if (character_direction & DIR_W) char_seq = [33,34,35,36];
                    if (character_direction & DIR_E) char_seq = [1,2,3,4];     
                    if (character_direction & DIR_N) char_seq = [49,50,51,52];
                    if (character_direction & DIR_S) char_seq = [17,18,19,20];
                    if (character_direction & DIR_N && character_direction & DIR_E) char_seq = [57,58,59,60];
                    if (character_direction & DIR_N && character_direction & DIR_W) char_seq = [41,42,43,44];
                    if (character_direction & DIR_S && character_direction & DIR_E) char_seq = [9,10,11,12];
                    if (character_direction & DIR_S && character_direction & DIR_W) char_seq = [25,26,27,28];
                    
                    // Finally, animate the dog.
                    character.draw(char_x, char_y, char_seq);
                }
                else
                {
                    character.draw(char_x, char_y, 0);
                }
                */
                // Animated characters
                var char_seq = 0;
                var char_look = 17;
                
                if (character_is_moving)
                {
                    if (character_direction & DIR_W) char_seq = [24,25,26];
                    if (character_direction & DIR_E) char_seq = [9,10,11];     
                    if (character_direction & DIR_N) char_seq = [0,1,2];
                    if (character_direction & DIR_S) char_seq = [16,17,18];
                    //if (character_direction & DIR_N && character_direction & DIR_E) char_seq = [57,58,59,60];
                    //if (character_direction & DIR_N && character_direction & DIR_W) char_seq = [41,42,43,44];
                    //if (character_direction & DIR_S && character_direction & DIR_E) char_seq = [9,10,11,12];
                    //if (character_direction & DIR_S && character_direction & DIR_W) char_seq = [25,26,27,28];
                    
                    // Finally, animate the dog.
                    character.draw(char_x, char_y, char_seq);
                }
                else
                {
                    if (character_look == DIR_W) char_look = 25;
                    if (character_look == DIR_E) char_look = 9;     
                    if (character_look == DIR_N) char_look = 1;
                    if (character_look == DIR_S) char_look = 17;
                    character.draw(char_x, char_y, char_look);
                } 
                
            }, framerate);
        
        </script>
    </head>


    <body>
        
        <canvas id="game"></canvas>
        
    </body>    
</html>