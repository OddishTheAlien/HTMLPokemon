<html>
    <head>
        <title>RPG GAME</title>
        <link rel="icon" href="favicon.ico">
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="motion.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="text/javascript"></script>
        <script src="rectangle.js" type="text/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 480;
            var canvasHeight = 360;
            
            var rel_x = 4;
            var rel_y = 0;
                                
            var bergwald = new Sprite("ChipSet/bergwald.png", 16, 16, 30, 16);
            
            var panorama = new Sprite("Panorama/AngrySheeps.jpg", 320, 240, 1, 1);
               
            var audio1 = new Audio('Music/banana-phone.ogg');
            var audio2 = new Audio('Music/forest.ogg');
            
            var mouse_x = 0;
            var mouse_y = 0;
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                // Easy access to grafics (gfx)
                window.gfx = Context.context;
                
                InitializeKeyboard();
                
                InitalizeAnimationCounters();
                
                InitalizeMouse();
            });
            
            $(window).on('load', function () {});
            
            setInterval(function() {
                // Background: TODO: Implement moving background
                // Stretch panorama to canavas size for a background
                panorama.draw2(0, 0, canvasWidth, canvasHeight);
                
                var char_collision_box = new Rectangle(char_x, char_y, character.spriteWidth, character.spriteWidth);
                
                ResetAnimationCounter();
                
                // Draw Map from a single spritesheet + indexMap 
                var bMapIndex = 0;        
                for (var h = 0; h < 22; h++) {
                    for (var w = 0; w < 22; w++, bMapIndex++) {
                        var tile_w = (w + rel_x) * 16;
                        var tile_h = (h + rel_y) * 16;
                        bergwald.draw(tile_w, tile_h, map[bMapIndex]-1);
                    }
                }
                
                var rect1 = new Rectangle(100, 100, 10, 10);
                rect1.draw('blue', true, 'blue',false);
                
                if (char_collision_box.rectInside(rect1)) {
                    rect1.draw('red',true,'red',false);
                    audio1.play();
                }
                else
                    audio1.pause();
                
                var rect2 = new Rectangle(200, 100, 10, 10);
                rect2.draw('green',true,'green',false);
                
                if (char_collision_box.rectInside(rect2)) {
                    rect2.draw('yellow',true,'yellow',false);
                    audio2.play();
                }
                else
                    audio2.pause();
                
                
                var mouseRect = new Rectangle(mouse_x, mouse_y, character.spriteWidth, character.spriteHeight);
                mouseRect.draw('white', false, 'black',true);
                
                drawMotion(); 
                
                
            }, framerate);
        
        </script>
        
    </head>


    <body>
        <h1 id="title" >game.html</h1>
        
        <p>
            Clicking on the game disables scrolling for this website. Press "Esc" to enable it again.
            
            <button onclick="enterFullscreen(document.getElementById('game'))" id="exit">Fullscreen</button>
        </p>
        
        <p>
            WASD or Arrow-Key: Character Control; Click: Moves Character to Mouse; +/-: Speed Up/Down
        </p>
    
        <canvas id="game"></canvas>
        
    </body>    
</html>