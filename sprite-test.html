<html>
    <head>
        <title>Sprite Test</title>
        <link rel="icon" href="favicon.ico">
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="text/javascript"></script>
        <script src="rectangle.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="dialog.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="event.js" type="text/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 1200;
            var canvasHeight = 800;
            
            var speed = 2;
            
            var panorama = new Sprite("Panorama/AngrySheeps.jpg", 320, 240, 1, 1);
            
            var character = new Sprite("CharSet/Mannschgerl.png", 320, 360, 3, 3);
            var motionEnabled = true;
            var character_is_moving = false;
            
            var mouse_x = 0;
            var mouse_y = 0;
            
            var charX = [0, 0];
            var charY = [0, 0];
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                // Easy access to grafics (gfx)
                window.gfx = Context.context;
                
                InitializeKeyboard();
                
                DisableScrollbar();
                
                InitalizeAnimationCounters();
            });
            
            $(window).on('load', function () { });
            
            setInterval(function() {
                // Background: TODO: Implement moving background
                // Stretch panorama to canavas size for a background
                panorama.draw2(0, 0, canvasWidth, canvasHeight);
                
                DrawEvents();
                
                
                ResetAnimationCounter();
                character_is_moving = false;
                
                
                
                // <if else> for four direction movement
                if (motionEnabled) {
                    if (key.up || key.w) {
                        charY[mapID] -= speed;
                        if (charY[mapID] < -16) {
                            charY[mapID] = -16;
                        }
                        character_is_moving = true;
                    }
                    if (key.down || key.s) {
                        charY[mapID] += speed;
                        if (charY[mapID] > canvasHeight-32) {
                            charY[mapID] = canvasHeight-32;
                        }
                        character_is_moving = true;
                    }
                    if (key.left || key.a) {
                        charX[mapID] -= speed;
                        if (charX[mapID] < -4) {
                            charX[mapID] = -4;
                        }
                        character_is_moving = true;
                    }
                    if (key.right || key.d) {
                        charX[mapID] += speed;
                        if (charX[mapID] > canvasWidth-20) {
                            charX[mapID] = canvasWidth-20;
                        }
                        character_is_moving = true;
                    }
                }
                
                
                
                if (key.plus) {
                    speed++;
                    if (speed > 10) {
                        speed = 10;
                    }
                }
                if (key.minus) {
                    speed--;
                    if (speed < 1) {
                        speed = 1;
                    }
                }
                if (key.o) {
                    // Mouse position
                    console.log("mouse_x: " +mouse_x+", mouse_y" +mouse_y);
                }
                
                if (key.p) {
                    // Position debug
                    console.log("charX[mapID]: " +cameraX[mapID]+", charY[mapID]" +cameraY[mapID]);
                }                
                
                // Animated characters
                var char_seq = 0;
                
                if (character_is_moving) {
                    char_seq = [0,1,2];
                    
                    character.draw(cameraX[mapID], cameraY[mapID], char_seq);
                }
                else
                    character.draw(cameraX[mapID], cameraY[mapID], 0);
                
                
            }, framerate);
        
        </script>
    </head>


    <body>
        
        <canvas id="game"></canvas>
        
    </body>    
</html>