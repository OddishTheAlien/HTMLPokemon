<html>
    <head>
        <title>RPG GAME</title>
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="application/javascript"></script>
        <script src="rectangle.js" type="application/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 320;
            var canvasHeight = 288;
            
            var char_x = 16;
            var char_y = 16;
            
            var speed = 2;
                     
            var sprite_width = 24;
            var sprite_height = 32;
            
            var stone = new Sprite("ChipSet/stone.png", 16, 16, 1, 1);
            var grass = new Sprite("ChipSet/grass.png", 16, 16, 1, 1);
            
            var character = new Sprite("CharSet/character.png", 24, 32, 8, 12);
            var character_is_moving = false;
            var character_direction = 0;
            var character_look = 0;
            
            var audio = new Audio('Music/banana-phone.m4a');
            //var audio = new Audio('Music/Forest.m4a');
            
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                // Easy access to grafics (gfx)
                window.gfx = Context.context;
                
                InitializeKeyboard();
                
                DisableScrollbar();
                
                InitalizeAnimationCounters();
            });
            
            $(window).on('load', function () { });
            
            setInterval(function() {
                var char_collision_box = new Rectangle(char_x, char_y, sprite_width, sprite_height);
                 
                var whiteCanvas = new Rectangle(0, 0, canvasWidth, canvasHeight);
                whiteCanvas.draw('white');
                
                var rect = new Rectangle(100, 100, 50, 50);
                rect.draw('blue', true, 'blue',false);
                
                if (char_collision_box.rectInside(rect)) {
                    rect.draw('red',true,'red',false);
                    audio.play();
                }
                else audio.pause();
                
                ResetAnimationCounter();

                //DrawMap();
                
                character_is_moving = false;
                
                character_direction = 0;
                
                if (key.enter) {
                    
                }
                // <if else> for four direction movement
                if (key.up || key.w) {
                    char_y -= speed;
                    if (char_y < -16) {
                        char_y = -16;
                    }
                    character_direction |= DIR_N;
                    character_look = DIR_N;
                    character_is_moving = true;
                }
                else if (key.down || key.s) {
                    char_y += speed;
                    if (char_y > 288-32) {
                        char_y = 288-32;
                    }
                    character_direction |= DIR_S;
                    character_look = DIR_S;
                    character_is_moving = true;
                }
                else if (key.left || key.a) {
                    char_x -= speed;
                    if (char_x < -4) {
                        char_x = -4;
                    }
                    character_direction |= DIR_W;
                    character_look = DIR_W;
                    character_is_moving = true;
                }
                else if (key.right || key.d) {
                    char_x += speed;
                    if (char_x > 320-20) {
                        char_x = 320-20;
                    }
                    character_direction |= DIR_E;
                    character_look = DIR_E;
                    character_is_moving = true;
                }
                if (key.plus) {
                    speed++;
                    if (speed > 10) {
                        speed = 10;
                    }
                }
                if (key.minus) {
                    speed--;
                    if (speed < 1) {
                        speed = 1;
                    }
                }
                if (key.o) {
                    
                }
                if (key.p) {
                    
                }
                
                // Animated characters
                var char_seq = 0;
                var char_look = 17;
                
                if (character_is_moving)
                {
                    if (character_direction & DIR_W) char_seq = [24,25,26];
                    if (character_direction & DIR_E) char_seq = [9,10,11];     
                    if (character_direction & DIR_N) char_seq = [0,1,2];
                    if (character_direction & DIR_S) char_seq = [16,17,18];
                    
                    character.draw(char_x, char_y, char_seq);
                }
                else
                {
                    if (character_look == DIR_W) char_look = 25;
                    if (character_look == DIR_E) char_look = 9;     
                    if (character_look == DIR_N) char_look = 1;
                    if (character_look == DIR_S) char_look = 17;
                    character.draw(char_x, char_y, char_look);
                } 
                // Show a the collision box around the character 
                char_collision_box.draw('black',false,'black',true)
                
            }, framerate);
        
        </script>
    </head>


    <body>
        
        <canvas id="game"></canvas>
        
    </body>    
</html>