<html>
    <head>
        <title>Collision-Demo</title>
        <link rel="icon" href="favicon.ico">
        <script src="utility.js" type="text/javascript"></script>
        <script src="jquery-3.2.1.js" type="text/javascript"></script>
        <script src="canvas.js" type="text/javascript"></script>
        <script src="maps.js" type="text/javascript"></script>
        <script src="animate.js" type="text/javascript"></script>
        <script src="spritesheet.js" type="text/javascript"></script>
        <script src="sprite.js" type="text/javascript"></script>
        <script src="world.js" type="text/javascript"></script>
        <script src="keyboard.js" type="text/javascript"></script>
        <script src="mouse.js" type="text/javascript"></script>
        <script src="motion.js" type="text/javascript"></script>
        <script src="point.js" type="text/javascript"></script>
        <script src="vector.js" type="text/javascript"></script>
        <script src="segment.js" type="application/javascript"></script>
        <script src="rectangle.js" type="application/javascript"></script>
        
        <script language = "javascript">
            
            var Context = null;
            var framerate = 24;
            
            var canvasWidth = 320;
            var canvasHeight = 288;
            
            var panorama = new Sprite("Panorama/AngrySheeps.jpg", 320, 240, 1, 1);
            
            var movRect_x = 80;
            var movRect_y = 170;
            var pol_x = 1;
            var pol_y = 1;
            
            var bumpRect_x = 145;
            var bumpRect_y = 119;
            
            var audio = new Audio('Music/banana-phone.m4a');
            
            
            $(document).ready(function() {
                
                Context = new HTML("game", canvasWidth, canvasHeight);
                
                // Easy access to grafics (gfx)
                window.gfx = Context.context;
                
                InitializeKeyboard();
                
                DisableScrollbar();
                
                InitalizeAnimationCounters();
            });
            
            $(window).on('load', function () { });
            
            setInterval(function() {
                var char_collision_box = new Rectangle(charX[mapID], charY[mapID], character.spriteWidth, character.spriteHeight);
                
                // Stretch panorama to canavas size for a background
                panorama.draw2(0, 0, canvasWidth, canvasHeight);
                
                // Music box
                var rect = new Rectangle(270, 238, 50, 50);
                rect.draw('blue', true, 'blue',false);
                
                if (char_collision_box.rectInside(rect)) {
                    rect.draw('red',true,'red',false);
                    audio.play();
                }
                else audio.pause();
                
                // Moveable Box
                var movRect = new Rectangle(movRect_x, movRect_y, 50, 50);
                movRect.draw('green', true, 'blue',false);
                
                if (char_collision_box.rectInside(movRect)) {
                    pol_x *= -1;
                    pol_y *= -1;
                    if (movRect_x < charX[mapID]) movRect_x -= speed;
                    if (movRect_x > charX[mapID]) movRect_x += speed;
                    if (movRect_y < charY[mapID]) movRect_y -= speed;
                    if (movRect_y > charY[mapID]) movRect_y += speed;
                }
                
                // Bumper Box
                var fixRect = new Rectangle(bumpRect_x, bumpRect_y, 50, 50);
                fixRect.draw('yellow', true, 'blue',false);
                var test = true;
                
                // Bump player
                if (char_collision_box.rectInside(fixRect)) {
                    if (bumpRect_x - character.spriteWidth < charX[mapID]) {
                        if (charX[mapID] < bumpRect_x + 50 - character.spriteWidth)
                            charX[mapID] -= speed;
                        else charX[mapID] += speed;
                    }
                    if (bumpRect_y - character.spriteHeight < charY[mapID]) {
                        if (charY[mapID] < bumpRect_y + 50 - character.spriteHeight)
                            charY[mapID] -= speed;
                        else charY[mapID] += speed;
                    }
                }
                
                // Bump MovBox
                if (movRect.rectInside(fixRect)) {
                    if (bumpRect_x - 50 < movRect_x) {
                        if (movRect_x < bumpRect_x)
                            movRect_x -= 2;
                        else movRect_x += 2;
                    }
                    if (bumpRect_y - 50 < movRect_y) {
                        if (movRect_y < bumpRect_y)
                            movRect_y -= 2;
                        else movRect_y += 2;
                    }
                }
                
                // movRect Border Collision check
                if (movRect_x < 0){
                    movRect_x += 1;
                    pol_x = 1;                    
                }
                if (movRect_x > 320-50) {
                    movRect_x -= 1;
                    pol_x = -1;
                }
                if (movRect_y < 0) {
                    movRect_y += 1;
                    pol_y = 1;
                }
                if (movRect_y > 288-50) {
                    movRect_y -= 1;
                    pol_y = -1;
                }
                
                movRect_x += pol_x;
                movRect_y += pol_y;
                
                ResetAnimationCounter();

                characterMotion();
                
                // Show a the collision box around the character 
                char_collision_box.draw('black',false,'black',true)
                
            }, framerate);
        
        </script>
    </head>


    <body>
        
        <canvas id="game"></canvas>
        
    </body>    
</html>